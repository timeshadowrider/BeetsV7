# ============================================================================
# BEETS CONFIGURATION - v7.5
# API keys and credentials are read from environment variables.
# Set them in your .env file (loaded by docker-compose).
# ============================================================================

directory: /music/library
library: /data/library.db

ui:
  color: yes

asciify_paths: no
per_disc_numbering: no
threaded: yes

paths:
  default: $albumartist/($year) $album%if{$albumdisambig, [$albumdisambig]}/$track $title
  singleton: Non-Album/$artist/($year) Singles/$title
  comp: Compilations/($year) $album%if{$albumdisambig, [$albumdisambig]}/$track $title

item_fields:
  albumartist_primary: ""

album_fields:
  albumartist_primary: ""

# ----------------------------------------------------------------------------
# IMPORT SETTINGS
# ----------------------------------------------------------------------------
import:
  incremental: yes
  move: yes
  copy: no
  write: yes
  log: /data/last_beets_imports.log
  detail: yes
  duplicate_action: skip
  timid: no
  autotag: yes
  fingerprint: yes
  art: yes
  group_albums: yes
  resume: no
  singleton: no
  quiet_fallback: asis
  none_rec_action: asis

# ----------------------------------------------------------------------------
# MATCHING & METADATA
# ----------------------------------------------------------------------------
match:
  unmatched_tracks: keep
  strong_rec_thresh: 0.10
  distance_weights:
    track_title: 1.0
    track_artist: 1.0
    album: 1.0
    track_index: 1.0
    track_length: 1.0
    data_source: 0.0
    missing_tracks: 0.2

tiebreak:
  bitrate: desc
  format: [FLAC, ALAC, AAC, MP3]
  bitdepth: desc
  samplerate: desc

logging:
  level: INFO
  handlers:
    file:
      filename: /data/beets.log
      format: '%(asctime)s [%(levelname)s] %(message)s'

# ----------------------------------------------------------------------------
# PLUGINS
# ----------------------------------------------------------------------------
plugins:
  - info
  - edit
  - mbsync
  - missing
  - inline
  - fromfilename
  - scrub
  - zero
  - the
  - ftintitle
  - lastgenre
  - albumtypes
  - chroma
  - discogs
  - musicbrainz
  - lyrics
  - fetchart
  - embedart
  - plexupdate
  - mpdupdate
  - smartplaylist

# ----------------------------------------------------------------------------
# CHROMA (AcoustID fingerprinting)
# ----------------------------------------------------------------------------
chroma:
  auto: yes

acoustid:
  apikey: $ENV{ACOUSTID_APIKEY}

# ----------------------------------------------------------------------------
# INLINE METADATA NORMALIZATION
# ----------------------------------------------------------------------------
inline:
  albumartist_clean: |
    import re
    normalized = re.sub(
        r'\s*(?:&|and|x|X|feat\.?|ft\.?|featuring|with|vs\.?)\s*',
        '|||',
        albumartist,
        flags=re.IGNORECASE
    )
    return normalized.split('|||')[0].strip()

  artist_clean: |
    import re
    normalized = re.sub(
        r'\s*(?:&|and|x|X|feat\.?|ft\.?|featuring|with|vs\.?)\s*',
        '|||',
        artist,
        flags=re.IGNORECASE
    )
    return normalized.split('|||')[0].strip()

# ----------------------------------------------------------------------------
# ARTWORK
# ----------------------------------------------------------------------------
embedart:
  auto: yes
  ifempty: yes
  remove_art_file: no
  maxwidth: 1200

fetchart:
  minwidth: 500
  maxwidth: 1200
  enforce_ratio: 10px
  auto: yes
  art_filename: cover
  sources: [coverart, filesystem, lastfm, fanarttv]
  lastfm_key: $ENV{LASTFM_KEY}
  fanarttv_key: $ENV{FANARTTV_KEY}
  store_source: yes
  cover_names: [cover, folder, front]

# ----------------------------------------------------------------------------
# FEATURED ARTISTS IN TITLE
# ----------------------------------------------------------------------------
ftintitle:
  auto: yes
  format: "(feat. {0})"

# ----------------------------------------------------------------------------
# GENRE
# ----------------------------------------------------------------------------
lastgenre:
  auto: yes
  count: 4
  prefer_specific: yes
  force: yes
  source: track
  separator: "; "
  fallback: ""

# ----------------------------------------------------------------------------
# DISCOGS
# ----------------------------------------------------------------------------
discogs:
  user_token: $ENV{DISCOGS_TOKEN}

# ----------------------------------------------------------------------------
# LYRICS
# ----------------------------------------------------------------------------
lyrics:
  auto: yes
  sources: [genius, lrclib, google]
  genius_api_key: $ENV{GENIUS_API_KEY}

# ----------------------------------------------------------------------------
# MPD
# ----------------------------------------------------------------------------
mpd:
  host: $ENV{VOLUMIO_MPD_HOST}
  port: $ENV{VOLUMIO_MPD_PORT}

# ----------------------------------------------------------------------------
# PLEX
# ----------------------------------------------------------------------------
plex:
  host: $ENV{PLEX_HOST}
  port: $ENV{PLEX_PORT}
  token: $ENV{PLEX_TOKEN}

# ----------------------------------------------------------------------------
# SMART PLAYLISTS
# ----------------------------------------------------------------------------
smartplaylist:
  relative_to: /music/library
  playlist_dir: /music/playlists
  playlists:
    - name: All_Music.m3u
      query: ""
    - name: Recent_Additions.m3u
      query: "added:-30d.."
    - name: High_Quality.m3u
      query: "bitrate:320000.."

# ----------------------------------------------------------------------------
# ZERO
# ----------------------------------------------------------------------------
zero:
  fields: [art]
